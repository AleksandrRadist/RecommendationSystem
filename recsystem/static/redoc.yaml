openapi: 3.0.2
info:
  title: 'Recommendation System REST API'
  version: ''
  description: |
    Запросы к API начинаются с `/api/`
    # Вернуться на сайт
    [Назад](http://81.88.118.62/)
    # Описание
    Рекомендательная система для продвижения партнерских услуг физическим лицам коммерческого банка на основе данных их транзакций
    # Логика
    - При помощи API авториованные пользователи могут создать заказ, получить данные о всех подтвержднных заказах или о конкректном заказе.
    - Также, отдельно для клиентов есть ресурс, дающий право создавать заказы, но получать ограниченную информаюцию в ответе и получать ограниченную информацию о конкретном заказе.

tags:
  - name: AUTH
    description: Авторизация
  - name: ORDERS
    description: Заказы на рекламу
  - name: MESSAGES
    description: Сообщения

paths:
  /auth/token/:
    post:
      tags:
        - AUTH
      description: Получение токена для авторизации в обмен на username и password.
      requestBody:
        content:
          application/json:
            schema:
              required:
                - username
                - password
              properties:
                username:
                  type: string
                password:
                  type: string
                  writeOnly: true
      responses:
        200:
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Token'
          description: ''
        401:
          description: No active account found with the given credentials
  /auth/token/refresh/:
    post:
      tags:
        - AUTH
      description: Обновление токена
      requestBody:
        content:
          application/json:
            schema:
              required:
                - refresh
              properties:
                refresh:
                  type: string
      responses:
        200:
          content:
            application/json:
              schema:
                type: object
                properties:
                  access:
                    type: string
                    title: access токен
          description: ''
        401:
          description: Token is invalid or expired


  /orders/:
    get:
      tags:
        - ORDERS
      description: |
        Список всех заказов
      responses:
        200:
          description: Список объектов
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: number
                    company_name:
                      type: string
                    email:
                      type: string
                    category:
                      type: string
                    code:
                      type: string
                    transactions_number:
                      type: number
                    clients_number:
                      type: number
                    clients:
                      type: string
                    date_start:
                      type: string (YYYY--mm-dd)
                    date_end:
                      type: string (YYYY--mm-dd)
                    days:
                      type: number
                    price:
                      type: number
                    confirmation_status:
                      type: bool
                    completion_status:
                      type: bool
                    creation_date:
                      type: string
                    completion_date:
                      type: string
                    acceptance_status:
                      type: bool
                    acceptance_date:
                      type: string


        401:
          description: Токен не валиден
        403:
          description: Нет прав доступа
      security:
      - jwt_auth:
        - read:admin
    post:
      tags:
        - ORDERS
      description: |
        Создать заказ
      requestBody:
        content:
          application/json:
            schema:
                type: object
                properties:
                  company_name:
                    type: string
                  email:
                    type: string
                  category:
                    type: string
                  date_start:
                    type: string (YYYY--mm-dd)
                  date_end:
                    type: string (YYYY--mm-dd)
      responses:
        200:
          description: Список объектов
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: number
                  company_name:
                    type: string
                  email:
                    type: string
                  category:
                    type: string
                  code:
                    type: string
                  transactions_number:
                    type: number
                  clients_number:
                    type: number
                  clients:
                    type: string
                  date_start:
                    type: string (YYYY--mm-dd)
                  date_end:
                    type: string (YYYY--mm-dd)
                  days:
                    type: number
                  price:
                    type: number
                  confirmation_status:
                    type: bool
                  completion_status:
                    type: bool
                  creation_date:
                    type: string
                  completion_date:
                    type: string
                  acceptance_status:
                    type: bool
                  acceptance_date:
                    type: string
        400:
          description: Ошибка
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'
        401:
          description: Токен не валиден
        403:
          description: Нет прав доступа
      security:
      - jwt_auth:
        - write:admin

  /orders/confirmed/:
    get:
      tags:
        - ORDERS
      description: |
        Список всех подтвержденных заказов
      responses:
        200:
          description: Список объектов
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: number
                    company_name:
                      type: string
                    email:
                      type: string
                    category:
                      type: string
                    code:
                      type: string
                    transactions_number:
                      type: number
                    clients_number:
                      type: number
                    clients:
                      type: string
                    date_start:
                      type: string (YYYY--mm-dd)
                    date_end:
                      type: string (YYYY--mm-dd)
                    days:
                      type: number
                    price:
                      type: number
                    confirmation_status:
                      type: bool
                    completion_status:
                      type: bool
                    creation_date:
                      type: string
                    completion_date:
                      type: string
                    acceptance_status:
                      type: bool
                    acceptance_date:
                      type: string
        401:
          description: Токен не валиден
        403:
          description: Нет прав доступа
      security:
      - jwt_auth:
        - read:admin


  /orders/unconfirmed/:
    get:
      tags:
        - ORDERS
      description: |
        Список всех подтвержденных заказов
      responses:
        200:
          description: Список объектов
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: number
                    company_name:
                      type: string
                    email:
                      type: string
                    category:
                      type: string
                    code:
                      type: string
                    transactions_number:
                      type: number
                    clients_number:
                      type: number
                    clients:
                      type: string
                    date_start:
                      type: string (YYYY--mm-dd)
                    date_end:
                      type: string (YYYY--mm-dd)
                    days:
                      type: number
                    price:
                      type: number
                    confirmation_status:
                      type: bool
                    completion_status:
                      type: bool
                    creation_date:
                      type: string
                    completion_date:
                      type: string
                    acceptance_status:
                      type: bool
                    acceptance_date:
                      type: string
        401:
          description: Токен не валиден
        403:
          description: Нет прав доступа
      security:
      - jwt_auth:
        - read:admin


  /orders/accepted/:
    get:
      tags:
        - ORDERS
      description: |
        Список всех принятых заказов
      responses:
        200:
          description: Список объектов
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: number
                    company_name:
                      type: string
                    email:
                      type: string
                    category:
                      type: string
                    code:
                      type: string
                    transactions_number:
                      type: number
                    clients_number:
                      type: number
                    clients:
                      type: string
                    date_start:
                      type: string (YYYY--mm-dd)
                    date_end:
                      type: string (YYYY--mm-dd)
                    days:
                      type: number
                    price:
                      type: number
                    confirmation_status:
                      type: bool
                    completion_status:
                      type: bool
                    creation_date:
                      type: string
                    completion_date:
                      type: string
                    acceptance_status:
                      type: bool
                    acceptance_date:
                      type: string
        401:
          description: Токен не валиден
        403:
          description: Нет прав доступа
      security:
      - jwt_auth:
        - read:admin


  /orders/completed/:
    get:
      tags:
        - ORDERS
      description: |
        Список всех выполненных заказов
      responses:
        200:
          description: Список объектов
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: number
                    company_name:
                      type: string
                    email:
                      type: string
                    category:
                      type: string
                    code:
                      type: string
                    transactions_number:
                      type: number
                    clients_number:
                      type: number
                    clients:
                      type: string
                    date_start:
                      type: string (YYYY--mm-dd)
                    date_end:
                      type: string (YYYY--mm-dd)
                    days:
                      type: number
                    price:
                      type: number
                    confirmation_status:
                      type: bool
                    completion_status:
                      type: bool
                    creation_date:
                      type: string
                    completion_date:
                      type: string
                    acceptance_status:
                      type: bool
                    acceptance_date:
                      type: string
        401:
          description: Токен не валиден
        403:
          description: Нет прав доступа
      security:
      - jwt_auth:
        - read:admin

  /orders/{order_id}/:
    parameters:
      - name: order_id
        in: path
        required: true
        description: ID объекта
        schema:
          type: number
    get:
      tags:
        - ORDERS
      description: |
        Информация о заказе
      security:
      - jwt_auth:
        - read:admin
      responses:
        200:
          description: Объект
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: number
                  company_name:
                    type: string
                  email:
                    type: string
                  category:
                    type: string
                  code:
                    type: string
                  transactions_number:
                    type: number
                  clients_number:
                    type: number
                  clients:
                    type: string
                  date_start:
                    type: string (YYYY--mm-dd)
                  date_end:
                    type: string (YYYY--mm-dd)
                  days:
                    type: number
                  price:
                    type: number
                  confirmation_status:
                    type: bool
                  completion_status:
                    type: bool
                  creation_date:
                    type: string
                  completion_date:
                    type: string
                  acceptance_status:
                    type: bool
                  acceptance_date:
                    type: string
        404:
          description: Объект не найден
        401:
          description: Токен не валиден
        403:
          description: Нет прав доступа

  /orders/{order_id}/complete/:
    parameters:
      - name: order_id
        in: path
        required: true
        description: ID объекта
        schema:
          type: number
    post:
      tags:
        - ORDERS
      description: |
        Отметить выполнение заказа
      security:
      - jwt_auth:
        - write:admin
      responses:
        200:
          description: Объект
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: number
                  company_name:
                    type: string
                  email:
                    type: string
                  category:
                    type: string
                  code:
                    type: string
                  transactions_number:
                    type: number
                  clients_number:
                    type: number
                  clients:
                    type: string
                  date_start:
                    type: string (YYYY--mm-dd)
                  date_end:
                    type: string (YYYY--mm-dd)
                  days:
                    type: number
                  price:
                    type: number
                  confirmation_status:
                    type: bool
                  completion_status:
                    type: bool
                  creation_date:
                    type: string
                  completion_date:
                    type: string
                  acceptance_status:
                    type: bool
                  acceptance_date:
                    type: string
        208:
          description: Заказ уже выполнен
        404:
          description: Объект не найден
        401:
          description: Токен не валиден
        403:
          description: Нет прав доступа
        409:
          description: Нельзя отметить выполнение неподтвержденного или непринятого заказа

  /orders/{order_id}/accept/:
    parameters:
      - name: order_id
        in: path
        required: true
        description: ID объекта
        schema:
          type: number
    post:
      tags:
        - ORDERS
      description: |
        Отметить принятие заказа
      security:
      - jwt_auth:
        - write:admin
      responses:
        200:
          description: Объект
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: number
                  company_name:
                    type: string
                  email:
                    type: string
                  category:
                    type: string
                  code:
                    type: string
                  transactions_number:
                    type: number
                  clients_number:
                    type: number
                  clients:
                    type: string
                  date_start:
                    type: string (YYYY--mm-dd)
                  date_end:
                    type: string (YYYY--mm-dd)
                  days:
                    type: number
                  price:
                    type: number
                  confirmation_status:
                    type: bool
                  completion_status:
                    type: bool
                  creation_date:
                    type: string
                  completion_date:
                    type: string
                  acceptance_status:
                    type: bool
                  acceptance_date:
                    type: string
        208:
          description: Заказ уже принят или выполнен
        404:
          description: Объект не найден
        401:
          description: Токен не валиден
        403:
          description: Нет прав доступа
        409:
          description: Нельзя принять неподтвержденный заказ

  /orders/{code}/confirm/:
    parameters:
      - name: code
        in: path
        required: true
        description: Код заказа
        schema:
          type: string
    post:
      tags:
        - ORDERS
      description: |
        Подтвердить заказ
      responses:
        200:
          description: Объект
          content:
            application/json:
              schema:
                type: object
                properties:
                  company_name:
                    type: string
                  email:
                    type: string
                  category:
                    type: string
                  code:
                    type: string
                  transactions_number:
                    type: number
                  clients_number:
                    type: number
                  date_start:
                    type: string (YYYY--mm-dd)
                  date_end:
                    type: string (YYYY--mm-dd)
                  days:
                    type: number
                  price:
                    type: number
                  confirmation_status:
                    type: bool
                  completion_status:
                    type: bool
        404:
          description: Объект не найден

  /orders/{code}/cancel/:
    parameters:
      - name: code
        in: path
        required: true
        description: Код заказа
        schema:
          type: string
    post:
      tags:
        - ORDERS
      description: |
        Отменить заказ
      responses:
        200:
          description: Объект
          content:
            application/json:
              schema:
                type: object
                properties:
                  company_name:
                    type: string
                  email:
                    type: string
                  category:
                    type: string
                  code:
                    type: string
                  transactions_number:
                    type: number
                  clients_number:
                    type: number
                  date_start:
                    type: string (YYYY--mm-dd)
                  date_end:
                    type: string (YYYY--mm-dd)
                  days:
                    type: number
                  price:
                    type: number
                  confirmation_status:
                    type: bool
                  completion_status:
                    type: bool
        404:
          description: Объект не найден
        409:
          description: Нельзя отменить выполненный или принятый заказ
  /orders/public/:
    post:
      tags:
        - ORDERS
      description: |
        Создать заказ
      requestBody:
        content:
          application/json:
            schema:
                type: object
                properties:
                  company_name:
                    type: string
                  category:
                    type: string
                  date_start:
                    type: string (YYYY--mm-dd)
                  date_end:
                    type: string (YYYY--mm-dd)
      responses:
        200:
          description: Список объектов
          content:
            application/json:
              schema:
                type: object
                properties:
                  company_name:
                    type: string
                  email:
                    type: string
                  category:
                    type: string
                  code:
                    type: string
                  transactions_number:
                    type: number
                  clients_number:
                    type: number
                  date_start:
                    type: string (YYYY--mm-dd)
                  date_end:
                    type: string (YYYY--mm-dd)
                  days:
                    type: number
                  price:
                    type: number
                  confirmation_status:
                    type: bool
                  completion_status:
                    type: bool
        400:
          description: Ошибка
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'

  /orders/public/{code}/:
    parameters:
      - name: code
        in: path
        required: true
        description: Код заказа
        schema:
          type: number
    get:
      tags:
        - ORDERS
      description: |
        Ограниченная информация о заказе для клиентов
      responses:
        200:
          description: Объект
          content:
            application/json:
              schema:
                type: object
                properties:
                  company_name:
                    type: string
                  email:
                    type: string
                  category:
                    type: string
                  code:
                    type: string
                  transactions_number:
                    type: number
                  clients_number:
                    type: number
                  date_start:
                    type: string (YYYY--mm-dd)
                  date_end:
                    type: string (YYYY--mm-dd)
                  days:
                    type: number
                  price:
                    type: number
                  confirmation_status:
                    type: bool
                  completion_status:
                    type: bool
        404:
          description: Объект не найден

  /messages/:
    get:
      tags:
        - MESSAGES
      description: |
        Список всех сообщений
      responses:
        200:
          description: Список объектов
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: number
                    email:
                      type: string
                    creation_date:
                      type: string
                    read_status:
                      type: bool
                    text:
                      type: string
        401:
          description: Токен не валиден
        403:
          description: Нет прав доступа
      security:
      - jwt_auth:
        - read:admin
    post:
      tags:
        - MESSAGES
      description: |
        Создать сообщение
      requestBody:
        content:
          application/json:
            schema:
                type: object
                properties:
                  email:
                    type: string
                  text:
                    type: string

      responses:
        200:
          description: Список объектов
          content:
            application/json:
              schema:
                type: object
                properties:
                  email:
                    type: string
                  text:
                    type: string
        400:
          description: Ошибка
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'

  /messages/new/:
    get:
      tags:
        - MESSAGES
      description: |
        Список новых сообщений
      responses:
        200:
          description: Список объектов
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: number
                    email:
                      type: string
                    creation_date:
                      type: string
                    read_status:
                      type: bool
                    text:
                      type: string
        401:
          description: Токен не валиден
        403:
          description: Нет прав доступа
      security:
      - jwt_auth:
        - read:admin

  /messages/read/:
    get:
      tags:
        - MESSAGES
      description: |
        Список прочитанных сообщений
      responses:
        200:
          description: Список объектов
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: number
                    email:
                      type: string
                    creation_date:
                      type: string
                    read_status:
                      type: bool
                    text:
                      type: string
        401:
          description: Токен не валиден
        403:
          description: Нет прав доступа
      security:
      - jwt_auth:
        - read:admin

  /messages/{message_id}/read/:
    parameters:
      - name: message_id
        in: path
        required: true
        description: Id сообщения
        schema:
          type: number
    post:
      tags:
        - MESSAGES
      description: |
        Отметить сообщение как прочитанное
      security:
      - jwt_auth:
        - write:admin
      responses:
        200:
          description: Список объектов
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: number
                  email:
                    type: string
                  creation_date:
                    type: string
                  read_status:
                    type: bool
                  text:
                    type: string
        401:
          description: Токен не валиден
        404:
          description: Объект не найден
        403:
          description: Нет прав доступа

  /messages/read/all/:
    post:
      tags:
        - MESSAGES
      description: |
        Отметить все сообщения как прочитанные
      security:
      - jwt_auth:
        - write:admin
      responses:
        200:
          description: Список объектов
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: number
                    email:
                      type: string
                    creation_date:
                      type: string
                    read_status:
                      type: bool
                    text:
                      type: string
        401:
          description: Токен не валиден
        403:
          description: Нет прав доступа


components:
  schemas:
    Token:
      title: Токен
      type: object
      properties:
        access:
          type: string
          title: access токен
        refresh:
          type: string
          title: update токен


    ValidationError:
      title: Ошибка валидации
      type: object
      properties:
        field_name:
          type: array
          items:
            type: string
  securitySchemes:
    jwt_auth:
      type: apiKey
      name: Bearer
      in: header


